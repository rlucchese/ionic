<ion-header>
  <ion-toolbar>
    <ion-title color="primary">Recebimento Compra</ion-title>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid class="campos " >
    <ion-row>
      <ion-col size-sm="8" size="12">
        <div class="input-icon-wrapper">
          <button type="button" class="input-icon-btn" (click)="buscarNotas()">
            <ion-icon name="search-outline"></ion-icon>
          </button>
          <ion-input
            (keyup.enter)="buscarNotas()"
            type="text"
            name="filtro"
            placeholder="Buscar Nota"
            [(ngModel)]="filtro"
          ></ion-input>
        </div>
      </ion-col>
      <ion-col size-sm="4" size="12">
        <div class="input-icon-wrapper">
          <button
            type="button"
            class="input-icon-btn"
            (click)="aplicarPedido()"
            [disabled]="!documentoFiscal || !documentoFiscal.itens || documentoFiscal.itens.length <= 0"
          >
            <ion-icon name="search-outline"></ion-icon>
          </button>
          <ion-input
            (keyup.enter)="aplicarPedido()"
            type="text"
            name="filtroPedido"
            placeholder="Pedido Compra"
            [(ngModel)]="filtroPedido"
            [disabled]="!documentoFiscal || !documentoFiscal.itens || documentoFiscal.itens.length <= 0"
          ></ion-input>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
<ion-item *ngIf="!this.documentoFiscal && this.msg" class="ion-align-itens-center">
{{this.msg}}</ion-item>
  <ion-grid class="cabecalho" *ngIf="this.documentoFiscal">
    <ion-row>
      <ion-col  sizeMd="3" sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Nota Fiscal</ion-label>
          <ion-input class="cabecalho" readonly="true" [value]="this.documentoFiscal.numero" type="text"></ion-input>
        </div>


      </ion-col>
      <ion-col sizeMd="3" sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Emissão</ion-label>
          <ion-input class="cabecalho" readonly="true" [value]="this.documentoFiscal.emissao | date:'shortDate' " type="text"></ion-input>
        </div>

      </ion-col>

      <ion-col sizeMd="6" sizeXs="12">
        <div class="ion-no-padding custom-input2 ">
          <ion-label class="floating-label">Fornecedor</ion-label>
          <ion-input   readonly="true" [value]="this.documentoFiscal.fornecedor" type="text"></ion-input>
        </div>
        
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid *ngIf="this.documentoFiscal?.itens">
    <ion-row>
      <ion-col size="12">
        <ion-item>
          <ion-label>Situação do Item</ion-label>
          <div class="cor-bar-label">
            <span
              class="cor-bar"
              *ngIf="corSelecionada !== 'todas'"
              [ngStyle]="{'background': corSelecionada}"
            ></span>
            <span
              class="cor-bar todas"
              *ngIf="corSelecionada === 'todas'"
            ></span>
          </div>
          <ion-select [(ngModel)]="corSelecionada">
            <ion-select-option value="todas">Todas</ion-select-option>
            <ion-select-option value="#EF9A9A">Sem Vinculo</ion-select-option>
            <ion-select-option value="#FFCC80" [ngStyle]="{'font-color': '#FFCC80'}">Vinculo Diferente</ion-select-option>
            <ion-select-option value="#C5E1A5">Vinculada</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>
    <ion-row [style]="'background-color:'+item.cor" class="borda" *ngFor="let item of itensFiltrados">
      <ion-col sizeMd="1" sizeXs="2">

        <div class="ion-no-padding custom-input2 ">
          <ion-label class="floating-label">Item</ion-label>
          <p [class.read]="true" readonly="true"  type="text">{{item.notaItem}}</p>
        </div>
      </ion-col>
      <ion-col  sizeMd="7" sizeXs="6">
        <div  class="ion-no-padding custom-input2 " >
          <ion-label class="floating-label">Produto</ion-label>
          <p [class.read]="true" readonly="true" type="text">{{item.notaProduto}}</p>
        </div>
      </ion-col>

      <ion-col sizeMd="2" sizeXs="2">
        <div lines="none" class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Qt NF</ion-label>
          <p [class.read]="true" readonly="true" type="text">{{item.notaQuantidade + ' ' + item.notaUnidade}}</p>
        </div>
      </ion-col>
      <ion-col   sizeMd="2"sizeXs="2">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Qt Pedido</ion-label>
          <p *ngIf="item.pedidoQuantidade" [class.read]="true" readonly="true" type="text">{{item.pedidoQuantidade + ' ' + item.pedidoUnidade}}</p>
          <p *ngIf="!item.pedidoQuantidade" [class.read]="true" readonly="true" type="text">   </p>

        </div>
      </ion-col>
      <ion-col   sizeMd="1"sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Pedido </ion-label>
          <ion-input class="fundo" (ionBlur)="onKeyDown($event, item)" (keyup.enter)="selecaoPedido(item, this.documentoFiscal.cnpj )"  [(ngModel)]="item.notaPedidoNumero" type="number"></ion-input>
          <ion-icon class="floating-icon"  slot="start" name="search" (click)="selecaoPedido(item, this.documentoFiscal.cnpj)"></ion-icon>

        </div>
      </ion-col>
      <ion-col   sizeMd="1"sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Item </ion-label>
          <ion-input class="fundo" (ionBlur)="onKeyDown($event, item)" (keyup.enter)="selecaoPedido(item, this.documentoFiscal.cnpj)" [(ngModel)]="item.notaPedidoItem" type="number"></ion-input>
          <ion-icon class="floating-icon"  slot="start" name="search" (click)="selecaoPedido(item, this.documentoFiscal.cnpj)"></ion-icon>

        </div>
      </ion-col>
     
      <ion-col   sizeMd="6"sizeXs="11">

    <div class="ion-no-padding custom-input2">
      <ion-label class="floating-label">Descrição</ion-label>

      <p class="fundo texto " (click)="selecaoProduto(item)"> {{item.entradaReferencia + ' -  ' + item.entradaDescricao}}    

      </p>
      
      <ion-icon class="floating-icon"  slot="start" name="search" ></ion-icon>
      <ion-icon *ngIf="item.notaPedidoItem" class="floating-icon2" (click)="abrirDesenho(item.entradaReferencia)"  slot="start" name="link" ></ion-icon>

    </div>


      </ion-col>


      <ion-col   sizeMd="2"sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Qt Entrada</ion-label>
          <ion-input class="fundo" [(ngModel)]="item.entradaQuantidade" type="number" ></ion-input>
        </div>
      </ion-col>
      <ion-col   sizeMd="1"sizeXs="6">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Unidade</ion-label>
          <p class="fundo"  type="text">{{item.entradaUnidade}}</p>
        </div>
      </ion-col>
      <ion-col   sizeMd="12"sizeXs="12">
        <div class="ion-no-padding custom-input2">
          <ion-label class="floating-label">Observação
          </ion-label>
          <ion-input class="fundo" clearInput="true" [(ngModel)]="item.observacao" type="text"></ion-input>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid> 
<ion-button  *ngIf="this.documentoFiscal?.itens" (click)="finalizar()" expand="block" color="secondary"  shape="round">
Finalizar
</ion-button>
  

</ion-content>